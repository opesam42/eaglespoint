{% extends "core/base.html" %}

{% block content %}

    <form method="POST" class="w-full lg:max-w-[400px] shadow-xl ring-2 ring-gray-900/5 px-6 pt-10 pb-8 flex flex-col gap-3 lg:gap-4" onsubmit="submitUnblockRequesttForm(event)" action="{% url 'user:send-unblock-request' %}">
        <h3 class="text-2xl font-bold mb-1.5">Request to Unblock Account</h3>

        <div>
            <label class="label-primary" for="id_sender_email">Email</label>
            <input class="input-primary" type="email" name="sender_email" autocomplete="email" maxlength="254" required id="id_sender_email" placeholder="Enter email">
        </div>

        <div>
            <label class="label-primary" for="id_body">Message</label>
            <textarea class="input-primary" name="body" id="id_body" required></textarea>
        </div>

        <button class="btn primary-btn" type="submit">Submit</button>
    </form>

{% endblock %}

{% block script %}
    <script>
        function submitUnblockRequesttForm(e){
            e.preventDefault();
            let form = e.target;
            formData = new FormData(form)

            const submitBtn = form.querySelector('button[type="submit"]');
            originalText = submitBtn.innerHTML   
            submitBtn.innerHTML = `<i class="fa fa-spinner fa-spin"></i> Sending Message...`;
            submitBtn.disabled = true; //prevent double click 

            fetch(form.action, {
                method: 'POST',
                headers: {
                    "X-Requested-With": "XMLHttpRequest",
                    "X-CSRFToken": getCsrfToken(),
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if(data.success){
                    showToastNotification('success', data.message)
                    form.reset();
                } else{
                    displayFormError(data.errors, form);
                    console.log(data.errors)
                    showToastNotification('warning', "Invalid form details");
                }
            })
            .catch(error => {
                console.error("Error", error)
                showToastNotification('danger', 'Something went wrong')
            })
            .finally(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            })
        }
    </script>
{% endblock %}